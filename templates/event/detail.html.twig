{% extends 'base.html.twig' %}

{% block title %}Details {{ event.name }}{% endblock %}
{% set user = app.user %}
{% set isOrganizer = event.organizer.id is same as(user.id) %}
{% set isParticipant = event.participants.contains(user)%}
{% set state = event.state.label %}
{% set isAdmin = app.user.isAdmin %}

{% block body %}

    <div class="card m-auto">
        <div class="banner">

        </div>

        <div class="card-body">
            <div class="row">
                    <div class="col-6"><h2 class="card-title mb-4">{{ event.name }}</h2></div>
                    <div class="col-6">
                    {% if isOrganizer and state is same as("En création") %}
                        <div class="text-right mb-3"><a href="{{ path('event_edit', { id : event.id}) }}" type="button" class="btn btn-warning">Modifier</a></div>
                    {% elseif isParticipant and state is same as('Ouverte') %}
                        <div class="text-right mb-3 "><a href="{{ path('event_unsubscribe', { id : event.id}) }}" type="button" class="btn btn-danger">Se désister</a></div>
                    {% elseif not isOrganizer and state is same as('Ouverte') and event.participants.count() < event.maxParticipants and date(event.signUpDeadline) >= date() %}
                        <div class="text-right mb-3"><a href="{{ path('event_subscribe', { id : event.id}) }}" type="button" class="btn btn-success">S'inscrire</a></div>
                    {% endif %}
                    {% if isAdmin or isOrganizer and state is same as("Ouverte") %}
                        <div class="text-right mb-3"><a href="{{ path('event_cancel', { id : event.id}) }}" type="button" class="btn btn-danger">Annuler la sortie</a></div>
                    {% endif %}
                    </div>
            </div>
            <p class="mb-4">{{ event.infos | raw }}</p>
            <p class="mb-2"><i class="fas fa-university mr-2"></i>{{ event.campus.name }}</p>
            <p class="mb-2"><i class="far fa-calendar-alt mr-2"></i>{{ event.startDate|date('d/m/Y H:m') }}</p>
            <p class="mb-2"><i class="fas fa-map-marker-alt mr-2"></i>{{ event.location }}</p>
            <p class="mb-2"><i class="far fa-clock mr-2"></i>{{ event.duration }} min.</p>
            <p class="mb-2"><i class="fas fa-stopwatch mr-2"></i> Inscrivez-vous avant : {{ event.signUpDeadline|date('d/m/Y') }}</p>
            <p class="mb-2"><i class="fas fa-clipboard-list mr-2"></i>Il reste {{ event.maxParticipants - event.participants.count}} places</p>
            <p class="mb-2"><i class="far fa-user mr-2"></i>Organisateur(trice) : <a href="{{ path("user_detail", {id: event.organizer.id}) }}">{{ event.organizer.nickname ? event.organizer.nickname : event.organizer.firstName ~ ' ' ~ event.organizer.lastName }}</a></p>
            <p class="mt-3"> Participants : </p>

            {% if event.participants.count > 0%}
                <ul>
                    {% for participant in event.participants %}
                        <li>
                            {{ participant.firstName ~ " " ~ participant.lastName }}
                        </li>
                    {% endfor %}

                </ul>

            {% else %}
            <p>Personne n'est inscrite pour le moment</p>
            {% endif %}
        </div>
    </div>
{% endblock %}

{% block stylesheets %}
    <style>
        .banner{
            height: 200px;
            background-image: url("{{ asset('images/default-event-details.jpg') }}");
        }
    </style>

{% endblock %}